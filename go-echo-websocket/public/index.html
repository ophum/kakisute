<html>

<head>
    <meta charset="utf-8" />
    <title>go-echo-websocket test</title>
</head>

<body>
    <button id="close">close</button>
    <p id="output"></p>

    <script>
        const ws = new WebSocket("ws://localhost:8080/ws")

        ws.onopen = function () {
            console.log("Connected")
        }

        ws.onmessage = function (e) {
            var out = document.getElementById("output");
            out.innerHTML += e.data + "<br />";
        }

        let i = 0;
        const id = setInterval(() => {
            try {
                ws.send(`Hello ${i++}`)
            } catch (e) {
                console.log(e)
                clearInterval(id)
            }
            console.log(ws.readyState)
        }, 1000);

        document.getElementById("close").addEventListener("click", () => {
            ws.close()
            console.log("close")
        })
    </script>

</body>

</html>
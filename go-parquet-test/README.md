# kakisute/go-parquet-test

arrow-go/parquet を利用して parquet ファイルを書き込んでみた

```bash
$ go run main.go
2025/01/26 23:21:54 timestamp write 10000000 rows
2025/01/26 23:21:54 name write 10000000 rows
2025/01/26 23:21:54 status write 10000000 rows
```

3 カラム 10000000 行書き込んで 134M

これはデータによって異なるのであまり参考にならないかもだけど...

```bash
$ ls -lah *.parquet
-rw-r--r-- 1 hum hum 134M Jan 26 23:21 test.parquet
```

duckdb で読み込んでみた

```bash
$ duckdb
v1.1.3 19864453f7
Enter ".help" for usage hints.
Connected to a transient in-memory database.
Use ".open FILENAME" to reopen on a persistent database.
D select * FROM 'test.parquet';
┌─────────────────────────┬─────────────┬──────────┐
│        timestamp        │    name     │  status  │
│        timestamp        │    blob     │  int32   │
├─────────────────────────┼─────────────┼──────────┤
│ 2025-01-26 14:21:52.166 │ test0       │      100 │
│ 2025-01-26 14:21:53.166 │ test1       │      101 │
│ 2025-01-26 14:21:54.166 │ test2       │      102 │
│ 2025-01-26 14:21:55.166 │ test3       │      103 │
│ 2025-01-26 14:21:56.166 │ test4       │      104 │
│ 2025-01-26 14:21:57.166 │ test5       │      105 │
│ 2025-01-26 14:21:58.166 │ test6       │      106 │
│ 2025-01-26 14:21:59.166 │ test7       │      107 │
│ 2025-01-26 14:22:00.166 │ test8       │      108 │
│ 2025-01-26 14:22:01.166 │ test9       │      109 │
│ 2025-01-26 14:22:02.166 │ test10      │      110 │
│ 2025-01-26 14:22:03.166 │ test11      │      111 │
│ 2025-01-26 14:22:04.166 │ test12      │      112 │
│ 2025-01-26 14:22:05.166 │ test13      │      113 │
│ 2025-01-26 14:22:06.166 │ test14      │      114 │
│ 2025-01-26 14:22:07.166 │ test15      │      115 │
│ 2025-01-26 14:22:08.166 │ test16      │      116 │
│ 2025-01-26 14:22:09.166 │ test17      │      117 │
│ 2025-01-26 14:22:10.166 │ test18      │      118 │
│ 2025-01-26 14:22:11.166 │ test19      │      119 │
│            ·            │   ·         │       ·  │
│            ·            │   ·         │       ·  │
│            ·            │   ·         │       ·  │
│ 2025-05-22 08:08:12.166 │ test9999980 │ 10000080 │
│ 2025-05-22 08:08:13.166 │ test9999981 │ 10000081 │
│ 2025-05-22 08:08:14.166 │ test9999982 │ 10000082 │
│ 2025-05-22 08:08:15.166 │ test9999983 │ 10000083 │
│ 2025-05-22 08:08:16.166 │ test9999984 │ 10000084 │
│ 2025-05-22 08:08:17.166 │ test9999985 │ 10000085 │
│ 2025-05-22 08:08:18.166 │ test9999986 │ 10000086 │
│ 2025-05-22 08:08:19.166 │ test9999987 │ 10000087 │
│ 2025-05-22 08:08:20.166 │ test9999988 │ 10000088 │
│ 2025-05-22 08:08:21.166 │ test9999989 │ 10000089 │
│ 2025-05-22 08:08:22.166 │ test9999990 │ 10000090 │
│ 2025-05-22 08:08:23.166 │ test9999991 │ 10000091 │
│ 2025-05-22 08:08:24.166 │ test9999992 │ 10000092 │
│ 2025-05-22 08:08:25.166 │ test9999993 │ 10000093 │
│ 2025-05-22 08:08:26.166 │ test9999994 │ 10000094 │
│ 2025-05-22 08:08:27.166 │ test9999995 │ 10000095 │
│ 2025-05-22 08:08:28.166 │ test9999996 │ 10000096 │
│ 2025-05-22 08:08:29.166 │ test9999997 │ 10000097 │
│ 2025-05-22 08:08:30.166 │ test9999998 │ 10000098 │
│ 2025-05-22 08:08:31.166 │ test9999999 │ 10000099 │
├─────────────────────────┴─────────────┴──────────┤
│ 10000000 rows (40 shown)               3 columns │
└──────────────────────────────────────────────────┘
```

DuckDB のドキュメントの例を試してみる

[Reading and Writing Parquet Files](https://duckdb.org/docs/data/parquet/overview.html)

```
D DESCRIBE SELECT * FROM "test.parquet";
┌─────────────┬─────────────┬─────────┬─────────┬─────────┬─────────┐
│ column_name │ column_type │  null   │   key   │ default │  extra  │
│   varchar   │   varchar   │ varchar │ varchar │ varchar │ varchar │
├─────────────┼─────────────┼─────────┼─────────┼─────────┼─────────┤
│ timestamp   │ TIMESTAMP   │ YES     │         │         │         │
│ name        │ BLOB        │ YES     │         │         │         │
│ status      │ INTEGER     │ YES     │         │         │         │
└─────────────┴─────────────┴─────────┴─────────┴─────────┴─────────┘

D SELECT * FROM parquet_metadata('test.parquet');
┌──────────────┬──────────────┬────────────────────┬──────────────────────┬─────────────────┬───┬──────────────────┬──────────────────────┬──────────────────────┬────────────────────┐
│  file_name   │ row_group_id │ row_group_num_rows │ row_group_num_colu…  │ row_group_bytes │ … │ data_page_offset │ total_compressed_s…  │ total_uncompressed…  │ key_value_metadata │
│   varchar    │    int64     │       int64        │        int64         │      int64      │   │      int64       │        int64         │        int64         │  map(blob, blob)   │
├──────────────┼──────────────┼────────────────────┼──────────────────────┼─────────────────┼───┼──────────────────┼──────────────────────┼──────────────────────┼────────────────────┤
│ test.parquet │            0 │           10000000 │                    3 │       269938533 │ … │           657633 │             50453148 │             80280657 │ {}                 │
│ test.parquet │            0 │           10000000 │                    3 │       269938533 │ … │         50847469 │             49342751 │            149066537 │ {}                 │
│ test.parquet │            0 │           10000000 │                    3 │       269938533 │ … │        100844552 │             40593285 │             40591339 │ {}                 │
├──────────────┴──────────────┴────────────────────┴──────────────────────┴─────────────────┴───┴──────────────────┴──────────────────────┴──────────────────────┴────────────────────┤
│ 3 rows                                                                                                                                                         24 columns (9 shown) │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

D SELECT * FROM parquet_schema('test.parquet');
┌──────────────┬───────────┬────────────┬─────────────┬─────────────────┬──────────────┬────────────────┬───────┬───────────┬──────────┬──────────────────────────────────────────────────────────────────┐
│  file_name   │   name    │    type    │ type_length │ repetition_type │ num_children │ converted_type │ scale │ precision │ field_id │                           logical_type                           │
│   varchar    │  varchar  │  varchar   │   varchar   │     varchar     │    int64     │    varchar     │ int64 │   int64   │  int64   │                             varchar                              │
├──────────────┼───────────┼────────────┼─────────────┼─────────────────┼──────────────┼────────────────┼───────┼───────────┼──────────┼──────────────────────────────────────────────────────────────────┤
│ test.parquet │ schema    │            │             │ REQUIRED        │            3 │                │       │           │          │                                                                  │
│ test.parquet │ timestamp │ INT64      │             │ REQUIRED        │              │                │       │           │          │ TimestampType(isAdjustedToUTC=0, unit=TimeUnit(MILLIS=MilliSec…  │
│ test.parquet │ name      │ BYTE_ARRAY │             │ REQUIRED        │              │                │       │           │          │                                                                  │
│ test.parquet │ status    │ INT32      │             │ REQUIRED        │              │                │       │           │          │                                                                  │
└──────────────┴───────────┴────────────┴─────────────┴─────────────────┴──────────────┴────────────────┴───────┴───────────┴──────────┴──────────────────────────────────────────────────────────────────┘

D CREATE TABLE test AS SELECT * FROM 'test.parquet';
D show tables;
┌─────────┐
│  name   │
│ varchar │
├─────────┤
│ test    │
└─────────┘
D select count(*) from test;
┌──────────────┐
│ count_star() │
│    int64     │
├──────────────┤
│     10000000 │
└──────────────┘
```
